/*! sink.min.js build:0.0.0, production. Copyright(c) 2013 Eric Zhang, Michelle Bu, Rolland Wu MIT Licensed */(function(e){function t(e,t,n){function a(e){var t=Object.keys(e);for(var i=0,o=t.length;i<o;i++){var u=t[i];r[u]=e[u]}n(s)}function f(e,t){for(var n=0,r=e.length;n<r;n++){var s=e[n];s[0]=s[0].split(".");var o=s[0].pop(),u=s[0].join(".");i[u][o]=s[1]}}typeof t=="function"&&(n=t,t={});var r={},i={};i[""]=r,t.version=1;var s=Proxy.create(util.getChromeProxyFunctions(r,t,"",i)),o=new WebSocket("ws://localhost:8080?room="+e);t.socket=o;var u={};o.onmessage=function(e){var n=JSON.parse(e.data);console.log("received message:",n);var r=n[0],i=n[1],s=n[2];r==="init"?a(i):r==="update"||r==="collision"?(f(i,s),r==="collision"&&t.collision&&t.collision(new Error("You tried to update the sink at the same time as someone else!"))):r==="success"&&(s=n[1]),t.version=s}}util={getChromeProxyFunctions:function(e,t,n,r){function s(){if(i.length===0)return;t.socket.send(JSON.stringify(["update",i,t.force?undefined:t.version])),i=[]}console.log("init proxy functions",t,n),n!==""&&(n+=".");var i=[];return{get:function(t,n){return e[n]},set:function(o,u,a){function f(e,n){if(typeof e!="object")return e;var i={},s=Proxy.create(util.getChromeProxyFunctions(i,t,n,r));r[n]=i,n!==""&&(n+=".");var o=Object.keys(e);for(var u=0,a=o.length;u<a;u+=1){var l=o[u];i[l]=f(e[l],n+l)}return s}if(!a.__sinkAddedProperty){var l=t.socket;i.push([n+u,a]),util.setZeroTimeout(s)}else a=a.__sinkAddedProperty;typeof a=="object"&&(a=f(a,n+u)),e[u]=a},getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getPropertyDescriptor:function(t){var n=Object.getPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},getPropertyNames:function(t){return Object.getPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete r[n+"."+t],delete e[t]},fix:function(){if(Object.isFrozen(e)){var t={},n=Object.getOwnPropertyNames(e);for(var r=0,i=n.length;r<i;r+=1){var s=n[r];t[s]=Object.getOwnPropertyDescriptor(e,s)}return t}return undefined}}},setZeroTimeout:function(e){function r(r){t.push(r),e.postMessage(n,"*")}function i(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}var t=[],n="zero-timeout-message";return e.addEventListener?e.addEventListener("message",i,!0):e.attachEvent&&e.attachEvent("onmessage",i),r}(this)},e.sink=t})(this)