/*! sink.min.js build:0.0.0, production. Copyright(c) 2013 Eric Zhang, Michelle Bu, Rolland Wu MIT Licensed */(function(e){function t(e,t){var n={},r={version:1},i=Proxy.create(util.getChromeProxyFunctions(n,r)),s=new WebSocket("ws://localhost:8080?room="+e);r.socket=s;var o={};s.onmessage=function(e){console.log("received message:"+e.data);var n=JSON.parse(e.data),s=n[0],u=n[1],a=u[0],f=u[1],l=u[2];if(s==="init"){console.log("init");for(var c=0,h=u.length;c<h;c++)i[a]=f;r.version=l,t(i),console.log("callback called")}else if(s==="update")if(l>r.version+1)o[l]=e;else if(l===r.version+1){for(var c=0,h=u.length;c<h;c++)i[a]=f;updateKeys=Object.keys(o);if(updateKeys.length!==0){var d=l+1;while(o[d]){var v=o[d],m=v[1],g=updateProperties[0],y=updateProperties[1];for(var c=0,h=updateProperties.length;c<h;c++)i[g]=updateLength;delete o[d],d+=1}}}else console.log("received old version: "+l),console.log("Current version is: "+r.version);else s=="collision"?console.log("Collision Detected!"):s=="success"&&(r.version=l)}}util={getChromeProxyFunctions:function(e,t){return{get:function(t,n){return e[n]},set:function(n,r,i){var s=t.socket,o=["update",r,i,t.version];s.send(o),e[r]=i},getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getPropertyDescriptor:function(t){var n=Object.getPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},getPropertyNames:function(t){return Object.getPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e.name},fix:function(){if(Object.isFrozen(e)){var t={},n=Object.getOwnPropertyNames(e);for(var r=0,i=n.length;r<i;r+=1){var s=n[r];t[s]=Object.getOwnPropertyDescriptor(e,s)}return t}return undefined}}},setZeroTimeout:function(e){function r(r){t.push(r),e.postMessage(n,"*")}function i(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}var t=[],n="zero-timeout-message";return e.addEventListener?e.addEventListener("message",i,!0):e.attachEvent&&e.attachEvent("onmessage",i),r}(this)},e.sink=t})(this)