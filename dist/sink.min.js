/*! sink.min.js build:0.0.0, production. Copyright(c) 2013 Eric Zhang, Michelle Bu, Rolland Wu MIT Licensed */(function(e){function t(e,t,n){function u(e){var t=Object.keys(e);for(var s=0,o=t.length;s<o;s++){var u=t[s];r[u]=e[u]}n(i)}function a(e,n){if(n&&n>t.version+1)o[n]=event;else if(!n||n===t.version+1){for(var s=0,u=e.length;s<u;s++){var a=e[s];r[a[0]]=a[1]}updateKeys=Object.keys(o);if(updateKeys.length!==0){var f=n+1;while(o[f]){var l=o[f],c=l[1],h=updateProperties[0],d=updateProperties[1];for(var s=0,u=updateProperties.length;s<u;s++)i[h]=updateLength;delete o[f],f+=1}}}else console.log("received old version: "+n),console.log("Current version is: "+t.version)}typeof t=="function"&&(n=t,t={});var r={};t.version=1;var i=Proxy.create(util.getChromeProxyFunctions(r,t,"")),s=new WebSocket("ws://localhost:8080?room="+e);t.socket=s;var o={};s.onmessage=function(e){var n=JSON.parse(e.data);console.log("received message:",n);var r=n[0],i=n[1],s=n[2];r==="init"?u(i):r==="update"||r==="collision"?(a(i,s),r==="collision"&&t.collision&&t.collision(new Error("You tried to update the sink at the same time as someone else!"))):r==="success"&&(s=n[1]),t.version=s}}util={getChromeProxyFunctions:function(e,t,n){function i(){if(r.length===0)return;t.socket.send(JSON.stringify(["update",r,t.force?undefined:t.version])),r=[]}console.log("init proxy functions",t,n),n!==""&&(n+=".");var r=[];return{get:function(t,n){return e[n]},set:function(s,o,u){function a(e,n){if(typeof e!="object")return e;var r={},i=Proxy.create(util.getChromeProxyFunctions(r,t,n));n!==""&&(n+=".");var s=Object.keys(e);for(var o=0,u=s.length;o<u;o+=1){var f=s[o];r[f]=a(e[f],n+f)}return i}var f=t.socket;r.push([n+o,u]),typeof u=="object"&&(u=a(u,n+o)),e[o]=u,util.setZeroTimeout(i)},getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getPropertyDescriptor:function(t){var n=Object.getPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},getPropertyNames:function(t){return Object.getPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e.name},fix:function(){if(Object.isFrozen(e)){var t={},n=Object.getOwnPropertyNames(e);for(var r=0,i=n.length;r<i;r+=1){var s=n[r];t[s]=Object.getOwnPropertyDescriptor(e,s)}return t}return undefined}}},setZeroTimeout:function(e){function r(r){t.push(r),e.postMessage(n,"*")}function i(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}var t=[],n="zero-timeout-message";return e.addEventListener?e.addEventListener("message",i,!0):e.attachEvent&&e.attachEvent("onmessage",i),r}(this)},e.sink=t})(this)