/*! sink.min.js build:0.0.0, production. Copyright(c) 2013 Eric Zhang, Michelle Bu, Rolland Wu MIT Licensed */(function(e){function t(e,t){function u(e){var r=Object.keys(e);for(var s=0,o=r.length;s<o;s++){var u=r[s];n[u]=e[u]}t(i)}function a(e,t){if(t>r.version+1)o[t]=event;else if(t===r.version+1){for(var s=0,u=e.length;s<u;s++){var a=e[s];n[a[0]]=a[1]}updateKeys=Object.keys(o);if(updateKeys.length!==0){var f=t+1;while(o[f]){var l=o[f],c=l[1],h=updateProperties[0],d=updateProperties[1];for(var s=0,u=updateProperties.length;s<u;s++)i[h]=updateLength;delete o[f],f+=1}}}else console.log("received old version: "+t),console.log("Current version is: "+r.version)}var n={},r={version:1},i=Proxy.create(util.getChromeProxyFunctions(n,r)),s=new WebSocket("ws://localhost:8080?room="+e);r.socket=s;var o={};s.onmessage=function(e){var t=JSON.parse(e.data);console.log("received message:",t);var n=t[0],i=t[1],s=t[2];n==="init"?u(i):n==="update"?a(i,s):n==="collision"?console.log("Collision Detected!"):n==="success"&&(s=t[1]),r.version=s}}util={getChromeProxyFunctions:function(e,t){function r(){if(n.length===0)return;t.socket.send(JSON.stringify(["update",n,t.version])),n=[]}console.log("init proxy functions",t);var n=[];return{get:function(t,n){return e[n]},set:function(i,s,o){var u=t.socket;n.push([s,o]),e[s]=o,util.setZeroTimeout(r)},getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getPropertyDescriptor:function(t){var n=Object.getPropertyDescriptor(e,t);return n!==undefined&&(n.configurable=!0),n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},getPropertyNames:function(t){return Object.getPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e.name},fix:function(){if(Object.isFrozen(e)){var t={},n=Object.getOwnPropertyNames(e);for(var r=0,i=n.length;r<i;r+=1){var s=n[r];t[s]=Object.getOwnPropertyDescriptor(e,s)}return t}return undefined}}},setZeroTimeout:function(e){function r(r){t.push(r),e.postMessage(n,"*")}function i(r){r.source==e&&r.data==n&&(r.stopPropagation&&r.stopPropagation(),t.length&&t.shift()())}var t=[],n="zero-timeout-message";return e.addEventListener?e.addEventListener("message",i,!0):e.attachEvent&&e.attachEvent("onmessage",i),r}(this)},e.sink=t})(this)